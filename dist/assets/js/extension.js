var PhotoTab=function(){return this.CLIENT_ID="e93cb714fd35495691271c8230693731",this.REDIRECT_URL=chrome.identity.getRedirectURL("/"),this.ACCESS_TOKEN=!1,this.init=function(){var t=this;this.get_token(function(e){t.ACCESS_TOKEN=e,t.bind_events();var n=document.body.className,o=t.ACCESS_TOKEN?"authorized":"not-authorized";document.body.className=n+" "+o,t.ACCESS_TOKEN&&t.get_photos()})},this.ajax={x:function(){return new XMLHttpRequest},data:function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n},send:function(t,e,n,o,s){s=s?s:!0;var i=this.x();i.open(n,t,s),i.onreadystatechange=function(){4===i.readyState&&e(JSON.parse(i.responseText),i.status,i)},"POST"===n&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o)},get:function(t,e,n,o){n=this.data(n),this.send(t+(n.length?"?"+n.join("&"):""),e,"GET",null,o)},post:function(t,e,n,o){n=this.data(n),this.send(t,e,"POST",n.join("&"),o)}},this.bind_events=function(){var t=this;document.getElementById("auth-button").onclick=function(){chrome.identity.launchWebAuthFlow({url:"https://instagram.com/oauth/authorize/?client_id="+t.CLIENT_ID+"&redirect_uri="+t.REDIRECT_URL+"&response_type=token",interactive:!0},function(e){var n=e.substring(e.indexOf("=")+1);t.save({access_token:n})})}},this.get_photos=function(){var t=this;this.ajax.get("https://api.instagram.com/v1/users/self/feed",function(e,n){console.log(n),200===n&&(console.log(e),t.get_template("photos",e,function(t){document.getElementById("photo-grid").innerHTML+=t}))},{access_token:t.ACCESS_TOKEN})},this.get_template=function(t,e,n){var o=document.getElementById("templates"),s={command:"render",template:t,context:e};o.contentWindow.postMessage(s,"*"),window.addEventListener("message",function(t){n(t.data.html)})},this.get_token=function(t){chrome.storage.sync.get("access_token",function(e){return e.access_token?void t(e.access_token):void t(!1)})},this.save=function(t){chrome.storage.sync.set(t,function(){console.log("saved")})},this.init(),this};new PhotoTab;